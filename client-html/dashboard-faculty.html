<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faculty Dashboard - SmartCampus</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="icon" type="image/x-icon" href="https://cdn-icons-png.flaticon.com/512/3437/3437364.png">
    <style>
        .layout {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 260px;
            background: white;
            border-right: 1px solid var(--border);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
        }

        .main-content {
            flex: 1;
            background: var(--bg-light);
            padding: 2rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 0.5rem;
            transition: all 0.2s;
            font-weight: 500;
        }

        .nav-item:hover,
        .nav-item.active {
            background: #eff6ff;
            color: var(--primary);
        }

        .nav-item i {
            margin-right: 0.75rem;
            width: 1.25rem;
        }

        .upload-card {
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            border: 1px solid var(--border);
            max-width: 600px;
            margin: 0 auto;
        }

        .drop-zone {
            border: 2px dashed var(--border);
            border-radius: 0.75rem;
            padding: 3rem;
            text-align: center;
            margin-top: 1rem;
            transition: all 0.2s;
            cursor: pointer;
        }

        .drop-zone:hover,
        .drop-zone.dragover {
            border-color: var(--primary);
            background: #eff6ff;
        }
    </style>
</head>

<body>
    <div class="layout">
        <div class="sidebar">
            <div class="brand" style="margin-bottom: 3rem;">
                <div class="logo-icon"><i data-feather="book-open"></i></div>
                <span class="brand-name" style="font-size: 1.25rem;">SmartCampus</span>
            </div>
            <div class="nav-item active" onclick="switchView('view-upload')"><i data-feather="upload-cloud"></i> Upload
                Materials</div>
            <div class="nav-item"><i data-feather="list"></i> My Notes</div>
            <div class="nav-item" onclick="switchView('view-assignments')"><i data-feather="check-square"></i>
                Assignments</div>
            <div class="nav-item" onclick="switchView('view-attendance')"><i data-feather="map-pin"></i> Live Attendance
            </div>

            <div style="margin-top: auto;">
                <div class="nav-item" onclick="logout()"><i data-feather="log-out"></i> Logout</div>
            </div>
        </div>

        <div class="main-content">
            <!-- VIEW: UPLOAD -->
            <div id="view-upload" class="view-section">
                <div class="upload-card">
                    <h2 style="margin-bottom: 1.5rem;">Upload Study Material</h2>
                    <form id="uploadForm">
                        <div style="margin-bottom: 1rem;">
                            <label
                                style="display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">Select
                                Subject</label>
                            <select id="subjectSelect" required class="subject-select"
                                style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid var(--border); background: #f9fafb;">
                                <option value="">Loading subjects...</option>
                            </select>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label
                                style="display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">Title</label>
                            <input type="text" id="noteTitle" required placeholder="e.g. Unit 1 Introduction"
                                style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid var(--border);">
                        </div>
                        <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem;">
                                <input type="radio" name="upType" value="file" checked onchange="toggleType()"> File
                                Upload
                            </label>
                            <label style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem;">
                                <input type="radio" name="upType" value="link" onchange="toggleType()"> External Link
                            </label>
                        </div>
                        <div id="fileInputContainer" class="drop-zone"
                            onclick="document.getElementById('fileInput').click()">
                            <i data-feather="file"
                                style="width: 2rem; height: 2rem; color: var(--text-muted); margin-bottom: 0.5rem;"></i>
                            <p style="font-size: 0.9rem; color: var(--text-muted);">Click to upload or drag and drop</p>
                            <p id="fileName"
                                style="font-size: 0.8rem; color: var(--primary); margin-top: 0.5rem; font-weight: 500;">
                            </p>
                            <input type="file" id="fileInput" hidden
                                onchange="document.getElementById('fileName').textContent = this.files[0]?.name">
                        </div>
                        <div id="linkInputContainer" style="display: none;">
                            <input type="url" id="linkInput" placeholder="https://..."
                                style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid var(--border);">
                        </div>
                        <button type="submit" class="btn-primary" style="margin-top: 2rem;">
                            <i data-feather="upload" style="width: 1rem; margin-right: 0.5rem;"></i> Upload Note
                        </button>
                        <div id="statusMsg" style="margin-top: 1rem; text-align: center; font-size: 0.9rem;"></div>
                    </form>
                </div>
            </div>

            <!-- VIEW: ASSIGNMENTS -->
            <div id="view-assignments" class="view-section hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <h2 style="font-weight: 600;">Subject Assignments</h2>
                    <button class="btn-primary" onclick="showCreateAssignment()">
                        <i data-feather="plus" style="width: 1rem; margin-right: 0.5rem;"></i> Create Assignment
                    </button>
                </div>

                <div
                    style="background: white; padding: 1.5rem; border-radius: 1rem; border: 1px solid var(--border); margin-bottom: 2rem;">
                    <label style="display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">Filter
                        by Subject</label>
                    <select id="assignSubjectSelect" onchange="loadAssignments(this.value)"
                        style="width: 100%; max-width: 300px; padding: 0.5rem; border-radius: 0.5rem; border: 1px solid var(--border);">
                        <option value="">Select Subject...</option>
                    </select>
                </div>

                <div id="assignmentsList"
                    style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;">
                    <!-- Assignments go here -->
                    <p style="color: var(--text-muted);">Select a subject to view assignments.</p>
                </div>


            </div>

            <!-- SUBMISSIONS MODAL -->
            <div id="submissionsModal" class="modal hidden"
                style="position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 101; display: flex; align-items: center; justify-content: center;">
                <div
                    style="background: white; padding: 2rem; border-radius: 1rem; width: 90%; max-width: 800px; height: 80vh; display: flex; flex-direction: column;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 id="submissionsTitle">Submissions</h3>
                        <button onclick="document.getElementById('submissionsModal').classList.add('hidden')"
                            style="background:none; border:none; cursor:pointer;"><i data-feather="x"></i></button>
                    </div>
                    <div id="submissionsList" style="flex: 1; overflow-y: auto;"></div>
                </div>
            </div>

            <!-- VIEW: ATTENDANCE -->
            <div id="view-attendance" class="view-section hidden">
                <div class="upload-card" style="max-width: 800px;">
                    <h2 style="margin-bottom: 1.5rem;">Live Attendance</h2>

                    <div id="attendanceSetup">
                        <div style="margin-bottom: 1rem;">
                            <label
                                style="display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">Select
                                Class/Subject</label>
                            <select id="attendSubjectSelect" class="subject-select"
                                style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; border: 1px solid var(--border); background: #f9fafb;"></select>
                        </div>
                        <button class="btn-primary" onclick="startAttendance()"
                            style="width: 100%; padding: 1rem; font-size: 1.1rem;">
                            <i data-feather="play-circle" style="width: 1.2rem; margin-right: 0.5rem;"></i> Start
                            Attendance Session
                        </button>
                    </div>

                    <div id="activeSession" class="hidden" style="text-align: center; margin-top: 2rem;">
                        <div
                            style="background: #eff6ff; padding: 2rem; border-radius: 1rem; border: 2px dashed var(--primary); display: inline-block;">
                            <p style="color: var(--text-muted); margin-bottom: 1rem;">Ask students to scan or enter this
                                code:</p>
                            <h1 id="sessionCode"
                                style="font-size: 4rem; font-weight: 800; letter-spacing: 0.5rem; color: var(--primary); margin: 0;">
                                ----</h1>
                            <p style="margin-top: 1rem; font-size: 0.9rem; color: #dc2626;">Expires in 10 minutes</p>
                        </div>

                        <div style="margin-top: 2rem;">
                            <h3 style="margin-bottom: 1rem;">Live Log</h3>
                            <div id="attendanceLog"
                                style="max-height: 200px; overflow-y: auto; text-align: left; background: #f9fafb; padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border);">
                                <!-- Live updates -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CREATE ASSIGNMENT MODAL -->
            <div id="createAssignModal" class="modal hidden"
                style="position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 101; display: flex; align-items: center; justify-content: center;">
                <div style="background: white; padding: 2rem; border-radius: 1rem; width: 90%; max-width: 500px;">
                    <h3 style="margin-bottom: 1rem;">Create New Assignment</h3>
                    <form id="createAssignForm">
                        <div style="margin-bottom: 1rem;">
                            <label
                                style="display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">Subject</label>
                            <select id="newAssignSubject" required
                                style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 0.5rem;"></select>
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label
                                style="display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">Title</label>
                            <input type="text" id="newAssignTitle" required
                                style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 0.5rem;">
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <label
                                style="display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">Description</label>
                            <textarea id="newAssignDesc" rows="3"
                                style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 0.5rem; font-family: inherit;"></textarea>
                        </div>
                        <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                            <div style="flex: 1;">
                                <label
                                    style="display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">Due
                                    Date</label>
                                <input type="date" id="newAssignDate" required
                                    style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 0.5rem;">
                            </div>
                            <div style="flex: 1;">
                                <label
                                    style="display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">Total
                                    Marks</label>
                                <input type="number" id="newAssignMarks" value="100"
                                    style="width: 100%; padding: 0.75rem; border: 1px solid var(--border); border-radius: 0.5rem;">
                            </div>
                        </div>
                        <div style="display: flex; gap: 1rem;">
                            <button type="button"
                                onclick="document.getElementById('createAssignModal').classList.add('hidden')"
                                style="flex: 1; padding: 0.75rem; border: 1px solid var(--border); background: white; border-radius: 0.5rem; cursor: pointer;">Cancel</button>
                            <button type="submit" class="btn-primary" style="flex: 1;">Create</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script>
        feather.replace();
        const token = localStorage.getItem('token');

        // View Switching
        function switchView(viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');

            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const map = { 'view-upload': 0, 'view-assignments': 2, 'view-attendance': 3 }; // Index mapping
            if (map[viewId] !== undefined) document.querySelectorAll('.nav-item')[map[viewId]].classList.add('active');
        }

        // --- ASSIGNMENTS LOGIC ---
        async function loadAssignments(subjectId) {
            const list = document.getElementById('assignmentsList');
            if (!subjectId) {
                list.innerHTML = '<p style="color: var(--text-muted);">Select a subject to view assignments.</p>';
                return;
            }

            try {
                const res = await fetch(`http://localhost:5000/api/assignments/subject/${subjectId}`, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                const assignments = await res.json();

                if (assignments.length === 0) {
                    list.innerHTML = '<p style="color: var(--text-muted);">No assignments created yet.</p>';
                    return;
                }

                list.innerHTML = assignments.map(a => `
                    <div style="background: white; border: 1px solid var(--border); padding: 1.5rem; border-radius: 0.75rem;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <h4 style="font-weight: 600; font-size: 1.1rem;">${a.title}</h4>
                            <span style="font-size: 0.75rem; background: #fee2e2; color: #b91c1c; padding: 0.25rem 0.5rem; border-radius: 4px;">Due: ${new Date(a.dueAt).toLocaleDateString()}</span>
                        </div>
                        <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 1.5rem;">${a.description || ''}</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                             <span style="font-size: 0.8rem; font-weight: 500; color: var(--primary);">Max Marks: ${a.totalMarks}</span>
                             <button class="btn-primary" style="padding: 0.4rem 0.75rem; font-size: 0.85rem;" onclick="viewSubmissions('${a._id}')">View Submissions</button>
                        </div>
                    </div>
                `).join('');

            } catch (e) { console.error(e); }
        }

        function showCreateAssignment() {
            document.getElementById('submissionsModal').classList.add('hidden'); // Ensure overlapping modal is closed
            document.getElementById('createAssignModal').classList.remove('hidden');
        }

        document.getElementById('createAssignForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData();
            formData.append('subjectId', document.getElementById('newAssignSubject').value);
            formData.append('title', document.getElementById('newAssignTitle').value);
            formData.append('description', document.getElementById('newAssignDesc').value);
            formData.append('dueAt', document.getElementById('newAssignDate').value);
            formData.append('totalMarks', document.getElementById('newAssignMarks').value);

            try {
                const res = await fetch('http://localhost:5000/api/assignments', {
                    method: 'POST',
                    headers: {
                        Authorization: `Bearer ${token}`
                    },
                    body: formData
                });

                if (res.ok) {
                    alert('Assignment Created!');
                    document.getElementById('createAssignModal').classList.add('hidden');
                    document.getElementById('createAssignForm').reset();
                    // Refresh if active
                    const currentSub = document.getElementById('assignSubjectSelect').value;
                    if (currentSub === data.subjectId) loadAssignments(currentSub);
                } else {
                    const err = await res.json();
                    alert('Failed to create assignment: ' + (err.error || err.message));
                }
            } catch (err) { console.error(err); alert('Network Error'); }
        });

        // --- SUBMISSIONS LOGIC ---
        async function viewSubmissions(assignmentId) {
            document.getElementById('createAssignModal').classList.add('hidden'); // Ensure overlapping modal is closed
            const modal = document.getElementById('submissionsModal');
            const list = document.getElementById('submissionsList');
            modal.classList.remove('hidden');
            list.innerHTML = 'Loading submissions...';

            try {
                const res = await fetch(`http://localhost:5000/api/assignments/submissions/${assignmentId}`, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                const submissions = await res.json();

                if (submissions.length === 0) {
                    list.innerHTML = '<div style="padding: 2rem; text-align: center; color: var(--text-muted);">No submissions yet.</div>';
                    return;
                }

                list.innerHTML = `<table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="border-bottom: 1px solid var(--border); text-align: left;">
                            <th style="padding: 0.75rem;">Student</th>
                            <th style="padding: 0.75rem;">Status</th>
                            <th style="padding: 0.75rem;">Submitted At</th>
                            <th style="padding: 0.75rem;">Marks</th>
                            <th style="padding: 0.75rem;">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${submissions.map(s => `
                            <tr style="border-bottom: 1px solid var(--bg-light);">
                                <td style="padding: 0.75rem;">
                                    <div style="font-weight: 500;">${s.student?.name || 'Unknown'}</div>
                                    <div style="font-size: 0.75rem; color: var(--text-muted);">${s.student?.rollNumber || ''}</div>
                                </td>
                                <td style="padding: 0.75rem;">
                                    <span style="padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.75rem; ${statusColor(s.status)}">${s.status}</span>
                                </td>
                                <td style="padding: 0.75rem; font-size: 0.85rem; color: var(--text-muted);">${new Date(s.submittedAt).toLocaleString()}</td>
                                <td style="padding: 0.75rem; font-weight: 600;">${s.marks !== undefined ? s.marks : '--'}</td>
                                <td style="padding: 0.75rem;">
                                    ${s.status === 'graded' ? '<span style="color: green; font-size: 0.85rem;">Graded</span>' :
                        `<button onclick="gradeSubmission('${s._id}')" style="color: var(--primary); background: #eff6ff; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer;">Grade</button>`}
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>`;

            } catch (e) { console.error(e); list.innerHTML = '<p style="color: red;">Error loading submissions</p>'; }
        }

        function statusColor(status) {
            if (status === 'late') return 'background: #fee2e2; color: #b91c1c;';
            if (status === 'graded') return 'background: #dcfce7; color: #166534;';
            return 'background: #eff6ff; color: #1e40af;';
        }

        window.gradeSubmission = async function (id) {
            const marks = prompt("Enter Marks:");
            if (!marks) return;
            const feedback = prompt("Enter Feedback (Optional):");

            try {
                const res = await fetch(`http://localhost:5000/api/assignments/submissions/${id}/grade`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` },
                    body: JSON.stringify({ marks, feedback })
                });
                if (res.ok) {
                    alert('Graded Successfully');
                    document.getElementById('submissionsModal').classList.add('hidden'); // Close to refresh easily
                }
            } catch (e) { console.error(e); }
        }



        // --- ATTENDANCE LOGIC ---
        let activeSessionId = null;
        let attendanceInterval = null;

        async function startAttendance() {
            const subjectId = document.getElementById('attendSubjectSelect').value;
            if (!subjectId) return alert("Select a subject first");

            // Mock Geolocation specifically for demo (Center of Campus)
            const campusLat = 12.9716;
            const campusLng = 77.5946;

            try {
                const res = await fetch('http://localhost:5000/api/attendance/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` },
                    body: JSON.stringify({
                        subjectId,
                        latitude: campusLat,
                        longitude: campusLng,
                        radius: 500 // Generous radius for demo
                    })
                });

                if (res.ok) {
                    const session = await res.json();
                    activeSessionId = session._id;

                    document.getElementById('attendanceSetup').classList.add('hidden');
                    document.getElementById('activeSession').classList.remove('hidden');
                    document.getElementById('sessionCode').textContent = session.qrCode;

                    // Start polling for updates
                    attendanceInterval = setInterval(fetchAttendanceLog, 3000);
                }
            } catch (e) { console.error(e); }
        }

        async function fetchAttendanceLog() {
            if (!activeSessionId) return;
            try {
                const res = await fetch(`http://localhost:5000/api/attendance/report/${activeSessionId}`, {
                    headers: { Authorization: `Bearer ${token}` }
                });
                const records = await res.json();
                const log = document.getElementById('attendanceLog');

                if (records.length === 0) {
                    log.innerHTML = '<p style="color: var(--text-muted);">Waiting for students...</p>';
                } else {
                    log.innerHTML = records.map(r => `
                        <div style="padding: 0.5rem; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between;">
                            <span>${r.student?.name || 'Unknown'}</span>
                            <span style="color: green; font-weight: 500;">Present</span>
                        </div>
                     `).join('');
                }
            } catch (e) { console.error(e); }
        }

        // Fetch user's subjects logic could be improved on backend to only show assigned subjects,
        // but for now reusing general subjects list or filtering if implementation allows.
        async function loadSubjects() {
            try {
                const res = await fetch('http://localhost:5000/api/subjects', {
                    headers: { Authorization: `Bearer ${token}` }
                });
                const data = await res.json();

                // Populate Upload Select
                const select = document.getElementById('subjectSelect');
                select.innerHTML = '<option value="">Select Subject...</option>' +
                    data.map(s => `<option value="${s._id}">${s.name} (${s.code})</option>`).join('');

                // Populate Assignments Filter
                const assignSelect = document.getElementById('assignSubjectSelect');
                assignSelect.innerHTML = '<option value="">Select Subject...</option>' +
                    data.map(s => `<option value="${s._id}">${s.name} (${s.code})</option>`).join('');

                // Populate New Assignment Subject
                const newAssignSelect = document.getElementById('newAssignSubject');
                newAssignSelect.innerHTML = data.map(s => `<option value="${s._id}">${s.name} (${s.code})</option>`).join('');

                // Populate Attendance Select
                document.getElementById('attendSubjectSelect').innerHTML = select.innerHTML;

            } catch (e) { console.error(e); }
        }

        function toggleType() {
            const type = document.querySelector('input[name="upType"]:checked').value;
            document.getElementById('fileInputContainer').style.display = type === 'file' ? 'block' : 'none';
            document.getElementById('linkInputContainer').style.display = type === 'link' ? 'block' : 'none';
        }

        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const status = document.getElementById('statusMsg');
            status.textContent = 'Uploading...';
            status.style.color = 'blue';

            const type = document.querySelector('input[name="upType"]:checked').value;
            const subject = document.getElementById('subjectSelect').value;
            const title = document.getElementById('noteTitle').value;

            const formData = new FormData();
            formData.append('title', title);
            formData.append('subject', subject);
            formData.append('description', 'Uploaded via Web');
            formData.append('unit', '1'); // Default
            formData.append('tags', 'lecture'); // Default

            if (type === 'file') {
                const file = document.getElementById('fileInput').files[0];
                if (!file) return alert('Please select a file');
                formData.append('file', file);
            } else {
                formData.append('fileUrl', document.getElementById('linkInput').value);
                formData.append('fileType', 'link');
            }

            try {
                const res = await fetch('http://localhost:5000/api/notes', {
                    method: 'POST',
                    headers: { Authorization: `Bearer ${token}` },
                    body: formData // No Content-Type header when sending FormData!
                });

                if (res.ok) {
                    status.textContent = 'Upload Successful!';
                    status.style.color = 'green';
                    e.target.reset();
                    document.getElementById('fileName').textContent = '';
                } else {
                    const d = await res.json();
                    status.textContent = d.message || 'Upload Failed';
                    status.style.color = 'red';
                }
            } catch (err) {
                status.textContent = 'Network Error';
                status.style.color = 'red';
            }
        });

        function logout() {
            localStorage.clear();
            window.location.href = 'index.html';
        }

        loadSubjects();
    </script>
</body>

</html>